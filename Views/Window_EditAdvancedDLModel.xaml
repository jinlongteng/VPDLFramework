<Window
    x:Class="VPDLFramework.Views.Window_EditAdvancedDLModel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:VPDLFramework.Views"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="{DynamicResource Lan.Window_EditAdvancedDLMode.TitleEditAdvancedDLMode}"
    Width="1200"
    Height="800"
    MinWidth="900"
    MinHeight="600"
    Background="{DynamicResource Color_DarkBackground}"
    WindowStartupLocation="CenterScreen"
    WindowStyle="SingleBorderWindow"
    mc:Ignorable="d">
    <Grid>
        <Border BorderBrush="LightGray" BorderThickness="1">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="40" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <StackPanel Orientation="Horizontal">
                    <Button
                        Margin="5"
                        Padding="5"
                        Command="{Binding CmdAddAdvancedDLModelStep}"
                        Style="{StaticResource Style_Button_Ico}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Margin="2"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontFamily="{StaticResource Font_Ico}"
                                FontSize="16"
                                Text="&#xe6a9;" />
                            <TextBlock
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Text="{DynamicResource Lan.Window_EditAdvancedDLMode.BtnAddStep}" />
                        </Grid>
                    </Button>
                    <Button
                        Margin="5"
                        Padding="5"
                        Command="{Binding CmdAddAdvancedDLToolDLTypeToStep}"
                        CommandParameter="{Binding ElementName=listStep, Path=SelectedItem}"
                        Style="{StaticResource Style_Button_Ico}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Margin="2"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontFamily="{StaticResource Font_Ico}"
                                FontSize="16"
                                Text="&#xe74b;" />
                            <TextBlock
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Text="{DynamicResource Lan.Window_EditAdvancedDLMode.BtnAddTool}" />
                        </Grid>
                    </Button>
                    <Button
                        Margin="5"
                        Padding="5"
                        Command="{Binding CmdAddAdvancedDLToolNotDLTypeToStep}"
                        CommandParameter="{Binding ElementName=listStep, Path=SelectedItem}"
                        Style="{StaticResource Style_Button_Ico}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Margin="2"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontFamily="{StaticResource Font_Ico}"
                                FontSize="16"
                                Text="&#xe69e;" />
                            <TextBlock
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Text="{DynamicResource Lan.Window_EditAdvancedDLMode.BtnAddTool}" />
                        </Grid>
                    </Button>
                    <Button
                        Margin="5"
                        Padding="5"
                        Command="{Binding CmdUpdateAdvancedModelParaList}"
                        Style="{StaticResource Style_Button_Ico}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>
                            <TextBlock
                                Margin="2"
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                FontFamily="{StaticResource Font_Ico}"
                                FontSize="16"
                                Text="&#xe714;" />
                            <TextBlock
                                Grid.Column="1"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"
                                Text="{DynamicResource Lan.Window_EditAdvancedDLMode.BtnRefreshPara}" />
                        </Grid>
                    </Button>
                </StackPanel>
                <ListView
                    x:Name="listStep"
                    Grid.Row="1"
                    Background="{StaticResource Color_DarkBackground}"
                    BorderBrush="Gray"
                    BorderThickness="0,1,0,0"
                    Foreground="White"
                    ItemsSource="{Binding WorkStream.AdvancedDLSteps}"
                    ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="Margin" Value="0,2" />
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="ListViewItem">
                                        <Border
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="Gray"
                                            BorderThickness="0,0,0,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="50" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <StackPanel Orientation="Vertical">
                                                    <StackPanel VerticalAlignment="Top" Orientation="Horizontal">
                                                        <TextBlock
                                                            Padding="2"
                                                            VerticalAlignment="Center"
                                                            FontWeight="Black"
                                                            Text="{Binding StepName}" />
                                                    </StackPanel>
                                                    <Button
                                                        Width="30"
                                                        Height="30"
                                                        HorizontalAlignment="Left"
                                                        Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.CmdRemoveAdvancedDLModelStep}"
                                                        CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=DataContext}"
                                                        Content="&#xec45;"
                                                        FontFamily="{StaticResource Font_Ico}"
                                                        FontSize="16"
                                                        Foreground="{StaticResource Color_Red}"
                                                        Style="{StaticResource Style_Button_Ico}" />
                                                </StackPanel>
                                                <Expander
                                                    Grid.Column="1"
                                                    BorderThickness="0"
                                                    Style="{StaticResource Style_Expander}">
                                                    <Grid>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition />
                                                            <ColumnDefinition Width="50" />
                                                            <ColumnDefinition />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <Border
                                                            Margin="2"
                                                            BorderBrush="Gray"
                                                            BorderThickness="0.5"
                                                            CornerRadius="0">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="30" />
                                                                    <RowDefinition />
                                                                </Grid.RowDefinitions>
                                                                <Border BorderBrush="Gray" BorderThickness="0,0,0,0.5">
                                                                    <TextBlock
                                                                        Padding="3"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"
                                                                        Text="{DynamicResource Lan.Window_EditAdvancedDLMode.TextInputParaList}" />
                                                                </Border>
                                                                <DataGrid
                                                                    Grid.Row="1"
                                                                    MinWidth="200"
                                                                    Margin="0"
                                                                    BorderThickness="0"
                                                                    ItemsSource="{Binding InputParaList}"
                                                                    Style="{StaticResource Style_DataGrid}">
                                                                    <DataGrid.Columns>
                                                                        <DataGridTemplateColumn Width="*" Header="{DynamicResource Lan.Control_WorkEdit.TextName}">
                                                                            <DataGridTemplateColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                    <TextBlock
                                                                                        Padding="3"
                                                                                        VerticalAlignment="Center"
                                                                                        FontWeight="Bold"
                                                                                        Text="{Binding Key}" />
                                                                                </DataTemplate>
                                                                            </DataGridTemplateColumn.CellTemplate>
                                                                        </DataGridTemplateColumn>
                                                                        <DataGridTemplateColumn Width="200" Header="{DynamicResource Lan.Control_WorkEdit.TextType}">
                                                                            <DataGridTemplateColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                    <TextBlock
                                                                                        Padding="3"
                                                                                        VerticalAlignment="Center"
                                                                                        Text="{Binding Value}"
                                                                                        ToolTip="{Binding Value}" />
                                                                                </DataTemplate>
                                                                            </DataGridTemplateColumn.CellTemplate>
                                                                        </DataGridTemplateColumn>
                                                                    </DataGrid.Columns>
                                                                </DataGrid>
                                                            </Grid>
                                                        </Border>
                                                        <Border
                                                            Grid.Column="1"
                                                            HorizontalAlignment="Center"
                                                            VerticalAlignment="Center">
                                                            <Button
                                                                Padding="5"
                                                                Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.CmdTransferInputParaListToTools}"
                                                                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=DataContext}"
                                                                Content="&#xe69a;"
                                                                FontFamily="{StaticResource Font_Ico}"
                                                                FontSize="16"
                                                                Style="{StaticResource Style_Button_Ico}"
                                                                ToolTip="{DynamicResource Lan.Window_EditAdvancedDLMode.BtnTransferPara}" />
                                                        </Border>
                                                        <Border
                                                            Grid.Column="2"
                                                            Margin="2"
                                                            BorderBrush="Gray"
                                                            BorderThickness="0.5"
                                                            CornerRadius="0">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="30" />
                                                                    <RowDefinition />
                                                                </Grid.RowDefinitions>
                                                                <Border BorderBrush="Gray" BorderThickness="0,0,0,0.5">
                                                                    <TextBlock
                                                                        Padding="3"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"
                                                                        Text="{DynamicResource Lan.Window_EditAdvancedDLMode.TextToolList}" />
                                                                </Border>
                                                                <ListView
                                                                    Grid.Row="1"
                                                                    MinWidth="200"
                                                                    Margin="2"
                                                                    Background="Transparent"
                                                                    BorderThickness="0"
                                                                    ItemsSource="{Binding Tools}">
                                                                    <ListView.ItemContainerStyle>
                                                                        <Style TargetType="ListViewItem">
                                                                            <Setter Property="Background" Value="White" />
                                                                            <Setter Property="Margin" Value="0" />
                                                                            <Setter Property="Template">
                                                                                <Setter.Value>
                                                                                    <ControlTemplate TargetType="ListViewItem">
                                                                                        <StackPanel Margin="2" Orientation="Horizontal">
                                                                                            <Border CornerRadius="5">
                                                                                                <Border.Style>
                                                                                                    <Style TargetType="Border">
                                                                                                        <Style.Triggers>
                                                                                                            <DataTrigger Binding="{Binding ToolInfo.IsDLType}" Value="True">
                                                                                                                <Setter Property="Background" Value="CornflowerBlue" />
                                                                                                            </DataTrigger>
                                                                                                            <DataTrigger Binding="{Binding ToolInfo.IsDLType}" Value="False">
                                                                                                                <Setter Property="Background" Value="#84bf96" />
                                                                                                            </DataTrigger>
                                                                                                        </Style.Triggers>
                                                                                                    </Style>
                                                                                                </Border.Style>
                                                                                                <Grid>
                                                                                                    <Grid.ColumnDefinitions>
                                                                                                        <ColumnDefinition Width="30" />
                                                                                                        <ColumnDefinition />
                                                                                                        <ColumnDefinition />
                                                                                                    </Grid.ColumnDefinitions>
                                                                                                    <TextBlock
                                                                                                        Padding="5"
                                                                                                        VerticalAlignment="Center"
                                                                                                        FontFamily="{StaticResource Font_Ico}"
                                                                                                        FontSize="20">
                                                                                                        <TextBlock.Style>
                                                                                                            <Style TargetType="TextBlock">
                                                                                                                <Style.Triggers>
                                                                                                                    <DataTrigger Binding="{Binding ToolInfo.IsDLType}" Value="True">
                                                                                                                        <Setter Property="Text" Value="&#xe74b;" />
                                                                                                                    </DataTrigger>
                                                                                                                    <DataTrigger Binding="{Binding ToolInfo.IsDLType}" Value="False">
                                                                                                                        <Setter Property="Text" Value="&#xe69e;" />
                                                                                                                    </DataTrigger>
                                                                                                                </Style.Triggers>
                                                                                                            </Style>
                                                                                                        </TextBlock.Style>
                                                                                                    </TextBlock>
                                                                                                    <Border Grid.Column="1">
                                                                                                        <TextBlock
                                                                                                            Padding="2"
                                                                                                            VerticalAlignment="Center"
                                                                                                            FontWeight="Bold"
                                                                                                            Text="{Binding ToolInfo.ToolName}"
                                                                                                            ToolTip="{Binding ToolInfo.ToolName}" />
                                                                                                    </Border>
                                                                                                    <StackPanel Grid.Column="2" Orientation="Horizontal">
                                                                                                        <Grid>
                                                                                                            <StackPanel
                                                                                                                Margin="3"
                                                                                                                Orientation="Horizontal"
                                                                                                                Visibility="{Binding ToolInfo.IsDLType, Converter={StaticResource BoolToVisiblityDefaultVisibleCvt}}">
                                                                                                                <Button
                                                                                                                    Width="30"
                                                                                                                    Margin="1.5,-1"
                                                                                                                    Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.CmdEditAdvancedToolTB}"
                                                                                                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=DataContext}"
                                                                                                                    Content="&#xe606;"
                                                                                                                    FontFamily="{StaticResource Font_Ico}"
                                                                                                                    Style="{StaticResource Style_Button_Ico}" />
                                                                                                                <ComboBox
                                                                                                                    Name="ws"
                                                                                                                    Height="30"
                                                                                                                    MinWidth="100"
                                                                                                                    VerticalContentAlignment="Center"
                                                                                                                    BorderThickness="0"
                                                                                                                    DisplayMemberPath="WorkspaceName"
                                                                                                                    ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.DLWorkspaces}"
                                                                                                                    SelectedValue="{Binding ToolInfo.DLWorkspaceName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                                                                    SelectedValuePath="WorkspaceName">
                                                                                                                    <ComboBox.Style>
                                                                                                                        <Style TargetType="ComboBox">
                                                                                                                            <Style.Triggers>
                                                                                                                                <DataTrigger Binding="{Binding ElementName=btnResetDLWorkspace, Path=IsPressed}" Value="True">
                                                                                                                                    <Setter Property="SelectedIndex" Value="-1" />
                                                                                                                                </DataTrigger>
                                                                                                                            </Style.Triggers>
                                                                                                                        </Style>
                                                                                                                    </ComboBox.Style>
                                                                                                                </ComboBox>
                                                                                                                <ComboBox
                                                                                                                    Height="30"
                                                                                                                    MinWidth="100"
                                                                                                                    Margin="2,0"
                                                                                                                    VerticalContentAlignment="Center"
                                                                                                                    BorderThickness="0"
                                                                                                                    ItemsSource="{Binding ElementName=ws, Path=SelectedItem.Streams}"
                                                                                                                    SelectedValue="{Binding ToolInfo.DLStreamName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                                                                                    <ComboBox.Style>
                                                                                                                        <Style TargetType="ComboBox">
                                                                                                                            <Style.Triggers>
                                                                                                                                <DataTrigger Binding="{Binding ElementName=btnResetDLWorkspace, Path=IsPressed}" Value="True">
                                                                                                                                    <Setter Property="SelectedIndex" Value="-1" />
                                                                                                                                </DataTrigger>
                                                                                                                            </Style.Triggers>
                                                                                                                        </Style>
                                                                                                                    </ComboBox.Style>
                                                                                                                </ComboBox>
                                                                                                                <ComboBox
                                                                                                                    Height="30"
                                                                                                                    VerticalContentAlignment="Center"
                                                                                                                    BorderThickness="0"
                                                                                                                    ItemsSource="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.GPUList}"
                                                                                                                    SelectedIndex="{Binding ToolInfo.GPUIndex, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                                                                                <Button
                                                                                                                    x:Name="btnResetDLWorkspace"
                                                                                                                    Width="30"
                                                                                                                    Margin="5,0"
                                                                                                                    Content="&#xe6a6;"
                                                                                                                    FontFamily="{StaticResource Font_Ico}"
                                                                                                                    FontSize="16"
                                                                                                                    Style="{StaticResource Style_Button_Ico}" />
                                                                                                            </StackPanel>
                                                                                                            <!--  编辑ToolBlock  -->
                                                                                                            <Button
                                                                                                                Margin="3"
                                                                                                                Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.CmdEditAdvancedToolTB}"
                                                                                                                CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=DataContext}"
                                                                                                                Content="&#xe606;"
                                                                                                                FontFamily="{StaticResource Font_Ico}"
                                                                                                                Style="{StaticResource Style_Button_Ico}"
                                                                                                                Visibility="{Binding ToolInfo.IsDLType, Converter={StaticResource BoolToVisiblityDefaultHiddenCvt}}" />
                                                                                                        </Grid>
                                                                                                        <Button
                                                                                                            Width="30"
                                                                                                            Margin="3"
                                                                                                            Command="{Binding RelativeSource={RelativeSource AncestorType=Window}, Path=DataContext.CmdRemoveAdvancedTool}"
                                                                                                            Content="&#xe6b5;"
                                                                                                            FontFamily="{StaticResource Font_Ico}"
                                                                                                            FontSize="16"
                                                                                                            Style="{StaticResource Style_Button_Ico}">
                                                                                                            <Button.CommandParameter>
                                                                                                                <MultiBinding Converter="{StaticResource MultiBindingConverter_ObjectArrayCvt}">
                                                                                                                    <Binding Path="DataContext" RelativeSource="{RelativeSource AncestorType=ListViewItem, AncestorLevel=2}" />
                                                                                                                    <Binding Path="DataContext" RelativeSource="{RelativeSource AncestorType=ListViewItem}" />
                                                                                                                </MultiBinding>
                                                                                                            </Button.CommandParameter>
                                                                                                        </Button>
                                                                                                    </StackPanel>
                                                                                                </Grid>
                                                                                            </Border>
                                                                                        </StackPanel>
                                                                                    </ControlTemplate>
                                                                                </Setter.Value>
                                                                            </Setter>
                                                                        </Style>
                                                                    </ListView.ItemContainerStyle>
                                                                </ListView>
                                                            </Grid>
                                                        </Border>
                                                        <Border
                                                            Grid.Column="3"
                                                            Margin="2"
                                                            BorderBrush="Gray"
                                                            BorderThickness="0.5">
                                                            <Grid>
                                                                <Grid.RowDefinitions>
                                                                    <RowDefinition Height="30" />
                                                                    <RowDefinition />
                                                                </Grid.RowDefinitions>
                                                                <Border BorderBrush="Gray" BorderThickness="0,0,0,0.5">
                                                                    <TextBlock
                                                                        Padding="3"
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Center"
                                                                        Text="{DynamicResource Lan.Window_EditAdvancedDLMode.TextOutputParaList}" />
                                                                </Border>
                                                                <DataGrid
                                                                    Grid.Row="1"
                                                                    MinWidth="200"
                                                                    Margin="0"
                                                                    BorderThickness="0"
                                                                    ItemsSource="{Binding OutputParaList}"
                                                                    Style="{StaticResource Style_DataGrid}">
                                                                    <DataGrid.Columns>
                                                                        <DataGridTemplateColumn Width="*" Header="{DynamicResource Lan.Control_WorkEdit.TextName}">
                                                                            <DataGridTemplateColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                    <TextBlock
                                                                                        Padding="3"
                                                                                        VerticalAlignment="Center"
                                                                                        FontWeight="Bold"
                                                                                        Text="{Binding Key}" />
                                                                                </DataTemplate>
                                                                            </DataGridTemplateColumn.CellTemplate>
                                                                        </DataGridTemplateColumn>
                                                                        <DataGridTemplateColumn Width="200" Header="{DynamicResource Lan.Control_WorkEdit.TextType}">
                                                                            <DataGridTemplateColumn.CellTemplate>
                                                                                <DataTemplate>
                                                                                    <TextBlock
                                                                                        Padding="3"
                                                                                        VerticalAlignment="Center"
                                                                                        Text="{Binding Value}"
                                                                                        ToolTip="{Binding Value}" />
                                                                                </DataTemplate>
                                                                            </DataGridTemplateColumn.CellTemplate>
                                                                        </DataGridTemplateColumn>
                                                                    </DataGrid.Columns>
                                                                </DataGrid>
                                                            </Grid>
                                                        </Border>
                                                    </Grid>
                                                </Expander>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                            <Style.Triggers>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" Value="{StaticResource Color_Selected}" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </ListView.ItemContainerStyle>
                </ListView>
            </Grid>
        </Border>
    </Grid>
</Window>
